<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>JALTOZ - Acceso Residente</title>
  <link rel="icon" type="image/svg+xml" href="../../JALTOZ.svg" />
  <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
  <link rel="stylesheet" href="style-vecino.css" />

  <script src="../../config.js"></script>
  <script src="../../mqtt.js" defer></script>
  <script src="./vecino.js" defer></script>
</head>

<body>
  <div id="main-wrapper">
    <div id="login-screen">
      <img src="../../JALTOZ.svg" class="logo-main" alt="Jaltoz Logo" />
      <h2>Acceso Residente</h2>
      <p>Ingrese su Nombre y Apellido</p>
      <div class="login-form">
        <input type="text" id="residentName" placeholder="Ej: Juan Pepe" />
        <button class="btn-call" onclick="verificarResidente()">
          INGRESAR
        </button>
      </div>
      <p id="login-error" class="error-msg"></p>
    </div>

    <header>
      <div class="header-info">
        <img src="../../JALTOZ.svg" alt="Logo" />
        <div>
          <div id="display-name" class="title">Cargando...</div>
          <div id="connection-status" class="status">Conectando...</div>
        </div>
      </div>
    </header>

    <!-- Panel de Acciones Extras -->
    <div style="text-align: center; margin: 10px;">
      <button onclick="mostrarMiQR()"
        style="background: #6f42c1; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; margin: 2px;">
        <i class="fas fa-id-card"></i> Mi Pase
      </button>
      <button onclick="mostrarFormularioInvitado()"
        style="background: #e0a800; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; margin: 2px;">
        <i class="fas fa-user-plus"></i> Crear Invitación
      </button>
    </div>

    <!-- Modal Invitado Input -->
    <div id="guest-form-container">
      <div class="modal-content">
        <h3>Nueva Invitación</h3>
        <p>Nombre del Visitante:</p>
        <input type="text" id="guestNameInput" placeholder="Ej: Pepito Pérez"
          style="width: 100%; padding: 8px; margin-bottom: 10px; box-sizing: border-box;">
        <button onclick="generarQRInvitado()"
          style="background: #28a745; color: white; border: none; padding: 10px; width: 100%; border-radius: 5px; cursor: pointer;">Generar
          Pase</button>
        <button onclick="cerrarFormularioInvitado()"
          style="margin-top: 10px; background: #666; color: white; border: none; padding: 5px; width: 100%; border-radius: 5px; cursor: pointer;">Cancelar</button>
      </div>
    </div>

    <!-- Modal/Overlay QR (Reutilizado) -->
    <div id="qr-display-container">
      <div class="modal-content">
        <h3 id="qr-title">Pase de Acceso</h3>
        <div id="qrcode" style="margin: 20px auto;"></div>
        <div id="qr-info"></div>
        <p style="color: #666; font-size: 0.9em;">Muestre este código en la portería</p>
        <button onclick="compartirQR()"
          style="margin-top: 5px; margin-right: 5px; background: #25D366; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer;">
          <i class="fab fa-whatsapp"></i> Compartir
        </button>
        <button onclick="cerrarMiQR()" style="margin-top: 15px; padding: 8px 16px;">Cerrar</button>
      </div>
    </div>


    <div id="messages"></div>

    <div id="input-area" class="disabled">
      <button id="btn-open" onclick="abrirPuertaRapido()" style="
            background: #28a745;
            color: white;
            border-radius: 10px;
            border: none;
            padding: 10px 15px;
            font-weight: bold;
            cursor: pointer;
            margin-right: 8px;
          ">
        ABRIR PUERTA
      </button>

      <input type="text" id="userInput" placeholder="Responder..." disabled />

      <button id="btn-send" onclick="enviarAlPortero()">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="white">
          <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path>
        </svg>
      </button>
    </div>
  </div>
</body>

</html>